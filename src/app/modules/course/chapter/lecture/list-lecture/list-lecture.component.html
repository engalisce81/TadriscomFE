<div class="list-container">
    
    @if (showDeleteConfirm) {
    <div class="modal-overlay">
        <div class="delete-card">
            <i class="bi bi-exclamation-triangle-fill warning-icon"></i>
            <h3>Delete Lecture?</h3>
            <p>Are you sure you want to delete <strong>{{ lectureToDelete?.title }}</strong>?</p>
            <div class="modal-actions">
                <button class="btn-cancel" (click)="cancelDelete()">Cancel</button>
                <button class="btn-confirm" (click)="deleteLecture()">Confirm Delete</button>
            </div>
        </div>
    </div>
    }

    <div class="toolbar">
        <div class="search-wrapper">
            <i class="bi bi-search search-icon"></i>
            <input type="text" [(ngModel)]="search" (input)="onSearchChange()" placeholder="Search lectures content..."
                class="search-input-modern" />
        </div>

        <button (click)="openCreateForm()" class="btn-create-modern" *ngIf="!showForm">
            <i class="bi bi-plus-lg"></i> <span>Add New Lecture</span>
        </button>
    </div>

    @if (showForm) {
    <div class="inline-form-card">
        <div class="form-header">
            <h3><i class="bi bi-pencil-square"></i> {{ isEditMode ? 'Update Lecture' : 'Create New Lecture' }}</h3>
            <button class="btn-close-form" (click)="closeForm()"><i class="bi bi-x-lg"></i></button>
        </div>

        <form [formGroup]="lectureForm" (ngSubmit)="submit()" class="modern-grid-form">
            <div class="form-row">
                <div class="form-group">
                    <label>Lecture Title *</label>
                    <input type="text" formControlName="title" class="form-control" placeholder="Enter title">
                </div>
                <div class="form-group">
                    <label>Short Content *</label>
                    <input type="text" formControlName="content" class="form-control" placeholder="Enter description">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Video URL</label>
                    <input type="text" formControlName="videoUrl" class="form-control" placeholder="YouTube or Vimeo link">
                </div>
                <div class="form-group">
                    <label>Success Rate (%)</label>
                    <input type="number" formControlName="successQuizRate" class="form-control">
                </div>
            </div>

            <div class="form-row triple">
                <div class="form-group">
                    <label>Quiz Time (min)</label>
                    <input type="number" formControlName="quizTime" class="form-control">
                </div>
                <div class="form-group">
                    <label>Allowed Tries</label>
                    <input type="number" formControlName="quizTryCount" class="form-control">
                </div>
                <div class="form-group">
                    <label>Questions Count</label>
                    <input type="number" formControlName="quizCount" class="form-control">
                </div>
            </div>

            <div class="pdf-upload-section">
                <label class="upload-label">
                    <i class="bi bi-cloud-upload"></i> Upload PDF Files
                    <input type="file" (change)="onPdfSelected($event)" multiple accept="application/pdf" hidden>
                </label>
                
                <div class="file-tags">
                    @for (url of existingPdfs; track $index) {
                        <span class="tag existing">
                            <i class="bi bi-file-earmark-check"></i> Old PDF {{ $index + 1 }} 
                            <i class="bi bi-x" (click)="removeExistingPdf($index)"></i>
                        </span>
                    }
                    @for (file of pdfFiles; track $index) {
                        <span class="tag new">
                            <i class="bi bi-file-earmark-plus"></i> {{ file.name }} 
                            <i class="bi bi-x" (click)="removeNewPdf($index)"></i>
                        </span>
                    }
                </div>
            </div>

            <div class="form-checkboxes">
                <label class="switch-label">
                    <input type="checkbox" formControlName="isVisible"> 
                    <span>Is Visible</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" formControlName="isFree"> 
                    <span>Free Lecture</span>
                </label>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="closeForm()">Discard</button>
                <button type="submit" class="btn-confirm" [disabled]="lectureForm.invalid || submitting">
                    {{ submitting ? 'Saving...' : (isEditMode ? 'Update Now' : 'Create Lecture') }}
                </button>
            </div>
        </form>
    </div>
    }

    @if (loading) {
    <div class="loading-overlay">
        <div class="spinner-modern"></div>
    </div>
    }

    @if (!loading) {
    <div class="cards-grid" [class.dimmed]="showForm">
        @for (lecture of lectures; track lecture.id) {
        <div class="course-card">
            <div class="card-header">
                <div class="lecture-icon-box">
                    <i class="bi bi-play-circle-fill"></i>
                </div>

                <div class="dropdown-actions">
                    <button class="dots-btn" (click)="$event.stopPropagation(); lecture.showMenu = !lecture.showMenu">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>

                    @if (lecture.showMenu) {
                    <div class="actions-menu" (mouseleave)="lecture.showMenu = false">
                        <button [routerLink]="['/lectures/questions', lecture.id]" title="View Questions">
                            <i class="bi bi-card-list"></i> Questions
                        </button>
                        <button (click)="openEditForm(lecture)">
                            <i class="bi bi-pencil-square"></i> Edit
                        </button>
                        <button class="text-danger" (click)="confirmDelete(lecture)">
                            <i class="bi bi-trash3"></i> Delete
                        </button>
                    </div>
                    }
                </div>
            </div>

            <div class="card-body">
                <div class="badge-group">
                    <span class="custom-badge">{{ lecture.chapterName }}</span>
                    @if (lecture.isFree) {
                    <span class="custom-badge free">Free</span>
                    }
                </div>

                <h3 class="course-name">{{ lecture.title }}</h3>
                <p class="course-title text-truncate">{{ lecture.content }}</p>

                <div class="details-grid">
                    <div class="detail-item">
                        <i class="bi bi-question-square"></i> {{ lecture.quizCount }} Quizzes
                    </div>
                    <div class="detail-item">
                        <i class="bi bi-clock"></i> {{ lecture.quizTime }} min
                    </div>

                    <div class="detail-item pdf-dropdown-container">
                        <button class="pdf-toggle-btn"
                            (click)="$event.stopPropagation(); lecture.showPdfs = !lecture.showPdfs"
                            [disabled]="!lecture.pdfUrls?.length">
                            <i class="bi bi-file-earmark-pdf"></i>
                            {{ lecture.pdfUrls?.length || 0 }} Files
                            <i class="bi bi-chevron-down arrow-icon"></i>
                        </button>

                        @if (lecture.showPdfs && lecture.pdfUrls?.length) {
                        <div class="pdf-menu" (mouseleave)="lecture.showPdfs = false">
                            @for (url of lecture.pdfUrls; track $index) {
                            <a [href]="url" target="_blank" class="pdf-link">
                                <i class="bi bi-file-pdf"></i> View PDF {{ $index + 1 }}
                            </a>
                            }
                        </div>
                        }
                    </div>

                    <div class="detail-item">
                        <i [class]="lecture.isVisible ? 'bi bi-eye text-success' : 'bi bi-eye-slash text-muted'"></i>
                        {{ lecture.isVisible ? 'Visible' : 'Hidden' }}
                    </div>
                </div>

                <div class="footer-actions">
                    <a [href]="lecture.videoUrl" target="_blank" class="btn-action-primary">
                        <i class="bi bi-play-btn"></i> Watch Video
                    </a>
                </div>
            </div>
        </div>
        }
    </div>
    }

    @if (totalCount > pageSize) {
    <div class="pagination-modern">
        <button class="page-nav" [disabled]="pageIndex === 1" (click)="onPageChange(pageIndex - 1)">
            <i class="bi bi-chevron-left"></i>
        </button>
        @for (p of pages; track p) {
        <button class="page-num" [class.active]="p === pageIndex" (click)="onPageChange(p)">
            {{ p }}
        </button>
        }
        <button class="page-nav" [disabled]="pageIndex === totalPages" (click)="onPageChange(pageIndex + 1)">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>
    }
</div>