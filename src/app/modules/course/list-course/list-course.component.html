<div class="list-container">

  @if (showDeleteConfirm) {
  <div class="modal-overlay">
    <div class="delete-card">
      <i class="bi bi-exclamation-triangle text-warning"></i>
      <h3>Delete Course?</h3>
      <p>Are you sure you want to delete <strong>{{ courseToDelete.name }}</strong>?</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="cancelDelete()">No, Cancel</button>
        <button class="btn-confirm" (click)="deleteCourse()">Yes, Delete</button>
      </div>
    </div>
  </div>
  }

  <div class="toolbar">
    <div class="search-wrapper">
      <i class="bi bi-search search-icon"></i>
      <input type="text" [ngModel]="search" (keyup)="onSearchKeyup($event)"
        placeholder="Search courses by name or title..." class="search-input-modern" />
    </div>

    <button routerLink="/courses/create" class="btn-create-modern">
      <i class="bi bi-plus-lg"></i> <span>Create New Course</span>
    </button>
  </div>

  @if (loading) {
  <div class="loading-overlay">
    <div class="spinner-modern"></div>
  </div>
  }

  @if (!loading) {
  <div class="cards-grid">
    @for (course of courses; track course.id) {
    <div class="course-card">
      <div class="card-header">
        <img [src]="course.logoUrl || '/assets/default-course.png'" class="course-logo" />

        <div class="dropdown-actions">
          <button class="dots-btn" (click)="$event.stopPropagation(); course.showMenu = !course.showMenu">
            <i class="bi bi-three-dots-vertical"></i>
          </button>

          @if (course.showMenu) {
          <div class="actions-menu" (mouseleave)="course.showMenu = false">
            <button [routerLink]="[course.id , 'chapters']" class="menu-btn">
              <i class="bi bi-layers-fill"></i>
              <span>Chapters Content</span>
            </button>

            <button [routerLink]="[course.id , 'exams']" class="menu-btn">
             <i class="bi bi-journal-text"></i>
              <span>Exams Content</span>
            </button>

            <button [routerLink]="['/courses/subscriber', course.id]" class="menu-btn">
              <i class="bi bi-people-fill"></i>
              <span>Subscribers</span>
            </button>

            @if(hasRole("admin")){
            <button [routerLink]="['/courses/requestjoin', course.id]" class="menu-btn">
              <i class="bi bi-person-check-fill"></i>
              <span>Join Requests</span>
            </button>
            }

            <button [routerLink]="[course.id , 'feedbacks']" class="menu-btn">
              <i class="bi bi-chat-left-dots-fill"></i>
              <span>Feedbacks</span>
            </button>

            <div class="menu-divider"></div> <button (click)="duplicate(course.id)" class="menu-btn">
              <i class="bi bi-files"></i>
              <span>Duplicate Course</span>
            </button>

            <button [routerLink]="['/courses/update', course.id]" class="menu-btn">
              <i class="bi bi-pencil-square"></i>
              <span>Edit Settings</span>
            </button>

            <button class="menu-btn text-danger" (click)="confirmDelete(course)">
              <i class="bi bi-trash3-fill"></i>
              <span>Delete Course</span>
            </button>

          </div>
          }
        </div>
      </div>

      <div class="card-body">
        <div class="badge-group">
          <span class="custom-badge college">{{ course.collegeName }}</span>
          <span class="custom-badge subject">{{ course.subjectName }}</span>
        </div>

        <h3 class="course-name" [title]="course.name">{{ course.name }}</h3>
        <p class="course-title">{{ course.title }}</p>

        <div class="details-grid">
          <div class="detail-item"><i class="bi bi-person-circle"></i> {{ course.userName }}</div>
          <div class="detail-item"><i class="bi bi-tag-fill"></i> {{ course.price }} EGP</div>
          <div class="detail-item"><i class="bi bi-star-fill text-warning"></i> {{ course.rating }}</div>
          <div class="detail-item">
            <i class="bi bi-circle-fill" [style.color]="course.isActive ? 'var(--success)' : '#666'"></i>
            {{ course.isActive ? 'Active' : 'Hidden' }}
          </div>
        </div>

        <div class="footer-actions">
          <a [href]="course.introductionVideoUrl" target="_blank" class="btn-action-outline">
            <i class="bi bi-youtube"></i> Intro
          </a>
          @if(course.isPdf) {
          <a [href]="course.pdfUrl" target="_blank" class="btn-action-primary">
            <i class="bi bi-file-earmark-pdf"></i> PDF
          </a>
          }
        </div>
      </div>
    </div>
    }
  </div>

  @if (courses.length === 0) {
  <div class="no-data">
    <i class="bi bi-inbox"></i>
    <p>No courses found matching your search.</p>
  </div>
  }

  @if (totalCount > pageSize) {
  <div class="pagination-modern">
    <button class="page-nav" [disabled]="pageIndex === 1" (click)="onPageChange(pageIndex - 1)">
      <i class="bi bi-chevron-left"></i>
    </button>

    @for (p of pages; track p) {
    <button class="page-num" [class.active]="p === pageIndex" (click)="onPageChange(p)">
      {{ p }}
    </button>
    }

    <button class="page-nav" [disabled]="pageIndex === totalPages" (click)="onPageChange(pageIndex + 1)">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
  }
  }
</div>