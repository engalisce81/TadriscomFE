<div class="list-container">
  <div class="toolbar">
    <div class="header">
      <h2>Create New Course</h2>
      <p class="subtitle">Choose the type and fill details</p>
    </div>
    <button routerLink="/dashboard/courses" class="btn-back">
      <i class="fas fa-arrow-left"></i> 
      <span>Back to List</span>
    </button>
  </div>

  <div class="course-type-tabs">
    <button type="button" class="tab-btn" [class.active]="selectedTab === courseTypes.General" (click)="selectTab(courseTypes.General)">
      <i class="bi bi-play-circle"></i> Standard Course
    </button>
    <button type="button" class="tab-btn" [class.active]="selectedTab === courseTypes.Quiz" (click)="selectTab(courseTypes.Quiz)">
      <i class="bi bi-patch-question"></i> Exams Only
    </button>
    <button type="button" class="tab-btn" [class.active]="selectedTab === courseTypes.Pdf" (click)="selectTab(courseTypes.Pdf)">
      <i class="bi bi-file-earmark-pdf"></i> PDF Library
    </button>
  </div>

  <div class="form-card">
    <form [formGroup]="courseForm" (ngSubmit)="submit()">
      
      <div class="row-grid">
        <div class="form-group">
          <label>Course Display Name *</label>
          <input type="text" formControlName="name" class="form-control" placeholder="e.g. Full Chemistry 2024">
        </div>
        <div class="form-group">
          <label>Title/Slogan *</label>
          <input type="text" formControlName="title" class="form-control" placeholder="e.g. Master Organic Chemistry">
        </div>
      </div>

      <div class="form-group">
        <label>Comprehensive Description *</label>
        <textarea formControlName="description" class="form-control" rows="4" placeholder="What will students learn?"></textarea>
      </div>

      <div class="row-grid">
        <div class="form-group">
          <label>Price (EGP) *</label>
          <input type="number" formControlName="price" class="form-control" placeholder="e.g. 2999">
        </div>
        <div class="form-group">
          <label>Category/Subject *</label>
          <select formControlName="subjectId" class="form-control">
            <option value="">-- Select Subject --</option>
            @for (s of subjects; track s.id) {
              <option [value]="s.id">{{ s.name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="animate-fade">
        @if (selectedTab !== courseTypes.Pdf) {
          <div class="form-group">
            <label class="video-label">
              <i class="bi bi-youtube"></i> Introduction Video URL (YouTube/Vimeo)
            </label>
            <input type="text" formControlName="introductionVideoUrl" class="form-control" placeholder="https://...">
          </div>
        }

        @if (selectedTab === courseTypes.Pdf) {
          <div class="form-group">
            <label class="pdf-label">Course Materials (PDF) *</label>
            <div class="file-upload-area pdf-upload-zone">
              <input type="file" (change)="onPdfSelected($event)" class="form-control" accept=".pdf">
              @if (pdfFileName) { 
                <div class="file-name-display">
                  ðŸ“„ {{ pdfFileName }}
                </div> 
              }
            </div>
          </div>
        }
      </div>

      <div class="form-group">
        <label>Course Banner/Logo *</label>
        <input type="file" (change)="onFileSelected($event)" class="form-control" accept="image/*">
        @if (logoPreview) {
          <div class="logo-preview-container">
            <img [src]="logoPreview" alt="Course banner preview">
          </div>
        }
      </div>

      <div class="checkbox-group">
        <div class="checkbox-grid">
          <label class="checkbox-container">
            <input type="checkbox" formControlName="isActive">
            <span class="checkmark"></span> 
            <span class="checkbox-label">Publicly Active</span>
          </label>
          <label class="checkbox-container">
            <input type="checkbox" formControlName="isLifetime">
            <span class="checkmark"></span> 
            <span class="checkbox-label">Unlimited Access</span>
          </label>
          <label class="checkbox-container">
            <input type="checkbox" formControlName="showSubscriberCount">
            <span class="checkmark"></span> 
            <span class="checkbox-label">Show Subscriber Count</span>
          </label>
        </div>
      </div>

      @if (!courseForm.get('isLifetime')?.value) {
        <div class="form-group animate-fade">
          <label>Subscription Period (Days)</label>
          <input type="number" formControlName="durationInDays" class="form-control" placeholder="e.g. 365">
        </div>
      }

      <div class="form-section" formArrayName="infos">
        <div class="section-header">
          <i class="bi bi-stars section-icon"></i>
          <h3>Key Course Features</h3>
        </div>

        <div class="features-list">
          @for (info of infos.controls; track $index) {
            <div class="feature-row">
              <input type="text" class="form-control" [formControlName]="$index" placeholder="e.g. Monthly Live Sessions">
              <button type="button" (click)="removeInfo($index)" class="btn-delete" title="Remove">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          }
        </div>

        <button type="button" (click)="addInfo()" class="btn-add-feature">
          <i class="bi bi-plus-circle"></i> Add Another Feature
        </button>
      </div>

      <div class="form-actions">
        <button type="button" routerLink="/dashboard/courses" class="btn-cancel">
          <i class="bi bi-x-circle"></i> Discard Changes
        </button>
        <button type="submit" class="btn-submit" [disabled]="loading || courseForm.invalid">
          @if (loading) { 
            <span class="spinner"></span> Processing... 
          } @else { 
            <i class="bi bi-cloud-arrow-up"></i> Finalize & Create Course 
          }
        </button>
      </div>
    </form>
  </div>
</div>